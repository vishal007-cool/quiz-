<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Using a custom font for better appearance */
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior: none; /* Prevents pull-to-refresh and other gestures */
        }
        /* Prevents ugly blue highlight on tap for touch devices */
        button {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="bg-zinc-800 flex items-center justify-center min-h-screen">

    <div id="app" class="bg-black flex flex-col w-full max-w-[400px] h-[90vh] max-h-[850px] rounded-[40px] shadow-2xl overflow-hidden relative font-sans">
        <!-- Calculator Display -->
        <div class="flex-1 flex flex-col justify-end items-end p-6 text-white overflow-hidden">
            <div id="history" class="h-8 text-2xl text-zinc-500 font-light text-right w-full truncate"></div>
            <div id="expression" class="h-20 w-full flex items-end justify-end transition-all duration-200 text-5xl font-light break-all text-right">0</div>
            <div id="result" class="h-14 text-4xl text-zinc-400 font-light text-right w-full truncate"></div>
        </div>

        <!-- Calculator Button Pad -->
        <div id="button-pad" class="grid grid-cols-4 gap-4 p-6">
            <!-- Buttons will be dynamically inserted here by JavaScript -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let expression = '';
            let result = '';
            let history = '';

            // --- DOM ELEMENT REFERENCES ---
            const historyEl = document.getElementById('history');
            const expressionEl = document.getElementById('expression');
            const resultEl = document.getElementById('result');
            const buttonPad = document.getElementById('button-pad');

            // --- SVG ICONS ---
            const backspaceIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-delete">
                    <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
                    <line x1="18" y1="9" x2="12" y2="15"></line>
                    <line x1="12" y1="9" x2="18" y2="15"></line>
                </svg>`;

            // --- BUTTON CONFIGURATION ---
            const buttons = [
                { label: 'AC', type: 'clear', style: 'bg-zinc-400 text-black' },
                { label: '%', type: 'percent', style: 'bg-zinc-400 text-black' },
                { label: 'Backspace', type: 'backspace', style: 'bg-zinc-400 text-black' },
                { label: '÷', type: 'operator', style: 'bg-orange-500 text-white' },
                { label: '7', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '8', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '9', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '×', type: 'operator', style: 'bg-orange-500 text-white' },
                { label: '4', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '5', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '6', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '-', type: 'operator', style: 'bg-orange-500 text-white' },
                { label: '1', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '2', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '3', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '+', type: 'operator', style: 'bg-orange-500 text-white' },
                { label: '00', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '0', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '.', type: 'number', style: 'bg-zinc-800 text-white' },
                { label: '=', type: 'equals', style: 'bg-orange-500 text-white' },
            ];

            // --- UI UPDATE FUNCTIONS ---

            // Function to update the display elements
            function updateDisplay() {
                expressionEl.textContent = expression || '0';
                resultEl.textContent = result;
                historyEl.textContent = history;
                updateFontSize();
            }

            // Function to dynamically adjust font size
            function updateFontSize() {
                const len = expression.length;
                expressionEl.classList.remove('text-5xl', 'text-4xl', 'text-3xl', 'text-2xl');
                if (len > 18) {
                    expressionEl.classList.add('text-2xl');
                } else if (len > 12) {
                    expressionEl.classList.add('text-3xl');
                } else if (len > 9) {
                    expressionEl.classList.add('text-4xl');
                } else {
                    expressionEl.classList.add('text-5xl');
                }
            }

            // --- CORE LOGIC ---

            // Function to calculate the result of the current expression
            function calculate() {
                if (!expression) {
                    result = '';
                    updateDisplay();
                    return;
                }

                let exprToEvaluate = expression;
                const lastChar = exprToEvaluate.slice(-1);

                if (['+', '-', '×', '÷', '.'].includes(lastChar)) {
                    exprToEvaluate = exprToEvaluate.slice(0, -1);
                }
                
                if (!exprToEvaluate) {
                    result = '';
                    updateDisplay();
                    return;
                }

                try {
                    const sanitizedExpr = exprToEvaluate.replace(/×/g, '*').replace(/÷/g, '/');
                    if (/[^0-9\.\*\/\+\-\(\)\s]/.test(sanitizedExpr)) {
                        return;
                    }
                    const calculatedResult = new Function('return ' + sanitizedExpr)();
                    const formattedResult = parseFloat(calculatedResult.toFixed(10));
                    result = `=${formattedResult}`;
                } catch (e) {
                    // Fail silently for incomplete expressions
                }
                updateDisplay();
            }

            // The main handler for all button clicks
            function handleButtonClick(value, type) {
                const operators = ['+', '-', '×', '÷'];
                const lastChar = expression.slice(-1);

                if (type === 'clear') {
                    expression = '';
                    result = '';
                    history = '';
                } else if (type === 'backspace') {
                    expression = expression.slice(0, -1);
                } else if (type === 'percent') {
                    if(!expression || isNaN(lastChar) && lastChar !== '.') return;
                    const matches = expression.match(/(\d+\.?\d*)$/);
                    if (matches) {
                        const lastNumber = matches[0];
                        const newNumber = String(parseFloat(lastNumber) / 100);
                        expression = expression.slice(0, -lastNumber.length) + newNumber;
                    }
                } else if (type === 'operator') {
                    if (expression === '' && value === '-') {
                        expression = '-';
                    } else if (expression === '' || lastChar === '.') {
                        return;
                    } else if (operators.includes(lastChar)) {
                        expression = expression.slice(0, -1) + value;
                    } else {
                        expression += value;
                    }
                } else if (type === 'equals') {
                    if (expression && result) {
                        history = `${expression}`;
                        expression = result.slice(1);
                        result = '';
                    }
                } else { // Number, '00', or '.'
                    if (value === '.') {
                        const parts = expression.split(/[+\-×÷]/);
                        if (parts.length > 0 && parts[parts.length - 1].includes('.')) return;
                    }
                    expression += value;
                }

                // Recalculate and update the display after every button press
                calculate();
            }

            // --- INITIALIZATION ---

            // Create and append buttons to the button pad
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = `flex items-center justify-center aspect-square rounded-full text-3xl font-medium focus:outline-none transition-transform duration-150 active:scale-90 hover:opacity-90 ${btn.style}`;
                button.innerHTML = btn.label === 'Backspace' ? backspaceIcon : btn.label;
                button.addEventListener('click', () => handleButtonClick(btn.label, btn.type));
                buttonPad.appendChild(button);
            });
            
            // Initial display update
            updateDisplay();
        });
    </script>
</body>
</html>

